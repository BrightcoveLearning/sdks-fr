---
title: 'Prise en charge d'Android Pie avec le SDK natif pour Android' la
description: Dans cette rubrique, vous apprendrez à utiliser Android Pie avec le Brightcove Native SDK pour Android.
parent: Framework 
grandparent: Android Development
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">Aperçu</h2>

<p>Android Pie est le dernier système d'exploitation Android et a été officiellement publié le 6 août 2018. Pour plus de détails sur les fonctionnalités, consultez le <a href="https://developer.android.com/about/versions/pie/android-9.0">Caractéristiques de la tarte Android</a> document. Android Pie inclut plusieurs changements de comportement. La plupart d'entre eux affectent les applications qui ciblent Android Pie (niveau API 28), mais vous pouvez également rencontrer des problèmes avec les applications ciblant une ancienne version d'Android, s'exécutant sur un appareil Android Pie.</p>

<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Android 9 Pie" src="/assets/images/android/framework/android-pie.png" />
<figcaption class="bcls-caption--image">Tarte Android 9</figcaption>
</figure>

<p>Il y a quelques changements à prendre en compte lors de l'utilisation du Brightcove SDK pour Android :</p>

<ul>
	<li><a href="">TLS activé par défaut</a></li>
	<li><a href="">Abandon du client HTTP Apache</a></li>
	<li><a href="">Constantes déconseillées</a></li>
</ul>

<p>Pour une liste complète des changements de comportement pour vos applications, consultez le <a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all">Changements de comportement pour toutes les applications</a> document. Pour les changements de comportement exclusifs lors du ciblage d'Android Pie, consultez le <a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28">Changements de comportement pour l'API 28+</a> document.</p>
</section>

<section class="bcls-section">
<h2 id="TLS_enabled_by_default">TLS activé par défaut</h2>

<p>Transport Layer Security (TLS) est un protocole permettant de sécuriser les communications sur un réseau informatique. TLS est implémenté au-dessus de HTTP, permettant une communication cryptée sur HTTPS.</p>

<p>Lorsque Google a publié Android Marshmallow (API niveau 23), il a fourni une configuration pour désactiver le trafic en texte clair, ce qui empêcherait votre application de faire des requêtes HTTP claires. Avec la sortie d'Android Pie (API niveau 28), le trafic en texte clair est désactivé par défaut.</p>

<p>Avec le trafic de texte en clair désactivé par défaut, si votre application tente d'effectuer une requête HTTP en clair, une exception IOException est levée avec le message suivant :</p>

<pre>
<code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>

<p>Pour plus d'informations, visitez le site de google : <a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28#framework-security-changes">Modifications de la sécurité du cadre</a> et <a href="https://developer.android.com/training/articles/security-config">Paramétrage de la sécurité réseau</a>.</p>

<p>Si votre application cible Android Pie (niveau API 28) ou supérieur, vous devez gérer ce changement de comportement afin que votre application fonctionne comme prévu. Vous avez trois options :</p>

<ul>
	<li><a href="#HTTPS_only">Assurez-vous que votre application ne fait que des requêtes HTTPS</a></li>
	<li><a href="#HTTP_for_all_domains">Activer le trafic HTTP clair pour tous les domaines</a></li>
	<li><a href="#HTTP_for_specific_domains">Activer le trafic HTTP clair pour des domaines spécifiques</a></li>
</ul>
<!-- <p>With the release of Android Pie (API level 28), clear text traffic is disabled by default. If your application attempts to do a clear HTTP request, an <code translate="No">IOException</code> will be thrown with the message:</p>
  <pre><code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>
  <p>
    To learn more about managing TLS with Android Pie, see the following document:
https://docs.google.com/document/d/1PfXOq59MG8s87gcwiZvzWCZ_CuKDpLi3VO-VRF_LkjY/edit?usp=sharing
  </p> -->

<h3 id="HTTPS_only">HTTPS uniquement</h3>

<p>Une option consiste à vous assurer que toutes vos requêtes réseau utilisent HTTPS. Pour ce faire, suivez ces étapes :</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>Activez votre CDN pour une communication sécurisée.</p>

	<ul>
		<li>Les clients de Video Cloud (que vous utilisiez le CDN maison ou un CDN nommé) doivent contacter leurs responsables de compte Brightcove pour s'assurer que les comptes sont configurés pour fournir via HTTPS.</li>
		<li>
			<p>
				Pour ceux qui utilisent des ressources distantes, vous devrez peut-être configurer votre CDN de manière appropriée.
			</p>
		<aside class="bcls-aside bcls-aside--information">Si vous utilisez BYO CDN, vous devez passer le bon <code translate="No">X-Forwarded-Proto: https</code> en-têtes. Pour Akamai ou Cloudfront, vous pouvez utiliser <code translate="No">X-Forwarded-Proto-Akamai</code> ou <code translate="No">CloudFront-Forwarded-Proto</code> respectivement.</aside></li>
	</ul>
	</li>
	<li>
	<p>Utilisez une communication sécurisée pour diffuser votre contenu multimédia. Cela inclut les vidéos, les publicités, les légendes, les images d'affiches, les vignettes et d'autres connexions API tierces.</p>

	<ul>
		<li>
		<p>Clients de Video Cloud : Utilisez l'API Playback pour récupérer le protocole sécurisé pour chacun de vos actifs. Le Brightcove SDK pour Android sélectionne HTTPS par défaut lorsqu'il est disponible.</p>

		<aside class="bcls-aside bcls-aside--information">Si votre vidéo contient à la fois des sources HTTP et HTTPS pour les sous-titres/sous-titres WebVTT, le SDK natif pour Android peut ne pas renvoyer la version HTTPS. Brightcove est conscient de cette situation et disposera d'un correctif dans une prochaine version.</aside>
		</li>
		<li>Clients Brightcove Player : Assurez-vous que votre contenu multimédia est diffusé via HTTPS.</li>
	</ul>
	</li>
</ol>

<h3 id="HTTP_for_all_domains">HTTP pour tous les domaines</h3>

<p>Votre application peut utiliser un trafic HTTP clair pour tous les domaines. Voici deux exemples de la façon dont vous pouvez procéder :</p>

<ul>
	<li><a href="#Update_the_application_tag">Mettre à jour la balise de l'application</a></li>
	<li><a href="#Add_a_network_security_configuration_file">Ajouter un fichier de configuration de sécurité réseau</a></li>
</ul>

<h4 id="Update_the_application_tag">Mettre à jour la balise de l'application</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p>Pour l'activer, ouvrez le <strong>AndroidManifeste</strong> fichier et ajoutez la ligne suivante dans le <code translate="No">application</code> étiqueter. Par exemple:</p>

	<pre>
<code class="language-java" translate="No">&lt;application
   android:name="mypackage.MyApplication"
   <span class="bcls-highlight">android:usesCleartextTraffic="true"&gt;</span>
…
&lt;/application&gt;</code></pre>
	</li>
</ol>

<h4 id="Add_a_network_security_configuration_file">Ajouter un fichier de configuration de sécurité réseau</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p>Créer un fichier xml, par exemple <strong>network-security-config.xml</strong> , et l'ajouter au <strong>res/xml</strong> annuaire. Consultez l'exemple suivant pour savoir comment autoriser un trafic clair :</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
   &lt;base-config cleartextTrafficPermitted="true"/&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>Définissez le nom du fichier dans votre <strong>AndroidManifeste</strong> comme indiqué ci-dessous:</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>Pour plus de détails, voir Android <a href="https://developer.android.com/training/articles/security-config">Paramétrage de la sécurité réseau</a> document.</p>
	</li>
</ol>

<h3 id="HTTP_for_specific_domains">HTTP pour des domaines spécifiques</h3>

<p>Vous pouvez spécifier certains domaines à autoriser à utiliser des requêtes HTTP claires. Pour le faire, suivez ces étapes:</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>Créer un fichier xml, par exemple <strong>network-security-config.xml</strong> , et l'ajouter au <strong>res/xml</strong> annuaire. Consultez l'exemple suivant pour savoir comment définir vos domaines :</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
 &lt;domain-config cleartextTrafficPermitted="true"&gt;
     &lt;domain includeSubdomains="true"&gt;c.brightcove.com&lt;/domain&gt;
     &lt;domain includeSubdomains="true"&gt;solutions.brightcove.com&lt;/domain&gt;
 &lt;/domain-config&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>Définissez le nom du fichier dans votre <strong>AndroidManifeste</strong> comme indiqué ci-dessous:</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>Pour plus de détails, voir Android <a href="https://developer.android.com/training/articles/security-config">Paramétrage de la sécurité réseau</a> document.</p>

	<aside class="bcls-aside bcls-aside--information">Les <code translate="No">networkSecurityConfig</code> paramètre remplace le <code translate="No">usesCleartextTraffic</code> paramètre. Cela signifie que si les deux sont activés, seuls les domaines déclarés dans le <code translate="No">networkSecurityConfig</code> Le paramètre de fichier sera autorisé à utiliser des requêtes HTTP claires.</aside>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Apache_HTTP_client_deprecation">Abandon du client HTTP Apache</h2>

<p>Avec Android Pie, la prise en charge du client HTTP Apache a été supprimée. Cela affecte les applications qui ciblent Android Pie ou supérieur. Cela peut également affecter les applications qui ciblent les anciennes versions d'Android lors de l'utilisation d'un <code translate="No">ClassLoader</code>. Au moment de l'exécution, si le <code translate="No">ClassLoader</code> tente de charger une classe client HTTP Apache sur Android Pie, il lancera un <code translate="No">NoClassDefFoundError</code>. Pour plus d'informations, consultez Google : <a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all#apache-nonp">Abandon du client HTTP Apache</a> document.</p>

<p>Si votre application utilise le plugin Brightcove FreeWheel, vous rencontrerez ce problème et obtiendrez une exception comme indiqué ici :</p>

<pre>
<code class="language-java" translate="No">java.lang.NoClassDefFoundError: tv.freewheel.utils.URLLoader
Caused by: java.lang.NoClassDefFoundError: Failed resolution of: Lorg/apache/http/impl/client/BasicCookieStore;</code></pre>

<p>Afin de résoudre ce problème, incluez la ligne suivante dans le fichier manifeste de votre application :</p>

<pre>
<code class="language-java" translate="No">&lt;uses-library android:name="org.apache.http.legacy" android:required="false"/&gt;</code></pre>
</section>

<section class="bcls-section">
<h2 id="Deprecated_constants">Constantes déconseillées</h2>

<p>Il y a plusieurs constantes qui ont été dépréciées dans le <a href="https://developer.android.com/reference/android/net/ConnectivityManager">Gestionnaire de connectivité</a> classer. Certaines de ces constantes sont actuellement utilisées par le Brightcove SDK, en particulier par les fonctionnalités de lecture hors ligne et d'analyse hors ligne. Voici la liste :</p>

<ul>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_BLUETOOTH</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_ETHERNET</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_MOBILE</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_VPN</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIFI</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIMAX</code></li>
</ul>

<p>Cela n'affecte aucune fonctionnalité sur les fonctionnalités mentionnées, mais sachez que ces constantes pourraient être supprimées dans une future version du système d'exploitation Android. Cela s'applique également au Brightcove Native SDK.</p>
</section>
<!-- <section class="bcls-section">
<h2 id="Testing_limitations">Testing limitations</h2>

<p>Due to resource constraints, we have been unable to test the Brightcove SDK targeting Android Pie on a device that has a "cut-out" in its display. We are working on acquiring such a device to test with as soon as possible.</p>
</section> --></article>