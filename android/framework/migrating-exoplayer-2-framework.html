---
title: 'Migration vers le framework ExoPlayer 2' la
description: Dans cette rubrique, vous apprendrez à utiliser le framework ExoPlayer 2 avec le Brightcove Native Player SDK pour Android.
parent: Framework 
grandparent: Android Development
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">Aperçu</h2>
<aside class="bcls-aside bcls-aside--information">
<p>Le Brightcove Native SDK pour Android utilisant ExoPlayer 1 est obsolète.</p>

<p>Si vous en avez besoin, vous pouvez consulter le <a href="/android/reference/exoplayer1/javadoc/index.html">la documentation de référence ExoPlayer 1</a> , mais il est recommandé de migrer vers ExoPlayer 2 Framework.</p>
</aside>

<p><a href="https://google.github.io/ExoPlayer/">ExoPlayer de Google</a> est un lecteur multimédia open source au niveau de l'application pour Android. Brightcove utilise ExoPlayer pour profiter des avantages qu'il offre. Pour plus d'informations sur les avantages de la mise à niveau vers ExoPlayer, consultez le <a href="https://www.brightcove.com/en/blog/2018/01/brightcove-native-sdk-exoplayer-2">SDK natif Brightcove avec ExoPlayer 2</a> article de blog.</p>

<p>Découvrez comment migrer pour les types de projets suivants :</p>

<ul>
	<li><a href="#New_project">Nouveau projet</a></li>
	<li><a href="#Existing_ExoPlayer_1_project">Projet ExoPlayer 1 existant</a></li>
	<li><a href="#Existing_MediaPlayer_project">Projet MediaPlayer existant</a></li>
</ul>

<p>Se référer au <a href="https://github.com/BrightcoveOS/android-player-samples">Exemples d'applications ExoPlayer</a> pour des conseils supplémentaires sur l'intégration de la <a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2</a> cadre dans votre projet.</p>
</section>

<section class="bcls-section">
<h2 id="New_project">Nouveau projet</h2>

<p>Suivez ces étapes pour ajouter ExoPlayer 2 à un nouveau projet Android :</p>

<ol class="bcls-tasklist">
	<li>Dans ton <strong>build.gradle</strong> fichier, ajoutez la dépendance suivante :

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li>Réglage de la <code translate="No">transitive</code> possibilité de <code translate="No">true</code> indique à gradle d'inclure automatiquement d'autres dépendances telles que le plug-in de lecture hors ligne. Si vous utilisez une version gradle inférieure à 5, le <a href="https://docs.gradle.org/current/userguide/dependency_management.html">dépendances transitives</a> sont désactivés par défaut. Vous devrez donc ajouter la déclaration suivante :
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>Si vous utilisez une variable d'environnement pour la version SDK, ouvrez le <strong>gradle.properties</strong> et définissez la valeur de la version actuelle du SDK natif pour Android. Cela devrait ressembler à ceci :
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_ExoPlayer_1_project">Projet ExoPlayer 1 existant</h2>

<p>Suivez ces étapes pour mettre à jour un projet ExoPlayer 1 existant afin d'utiliser le framework ExoPlayer 2 :</p>

<ol class="bcls-tasklist-restart">
	<li>Dans ton <strong>constantes.gradle</strong> , mettez à jour la version Android Build Tools :

	<pre class="line-numbers">
<code class="language-java" translate="No">buildToolsVersion "28.0.2"
</code></pre>
	</li>
	<li>Dans ton <strong>build.gradle</strong> fichier, mettez à jour les bibliothèques de support Android :
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.android.support:appcompat-v7:${APPCOMPAT_V7_VERSION}'
implementation 'com.android.support:support-v4:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:recyclerview-v7:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:support-vector-drawable:${SUPPORT_V4_VERSION}'
</code></pre>

	<p>Les valeurs actuelles des constantes se trouvent dans le <a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/constants.gradle">constantes.gradle</a> déposer.</p>
	</li>
	<li>Dans ton <strong>build.gradle</strong> fichier, ajoutez le dépôt Google Maven :
	<pre class="line-numbers">
<code class="language-java" translate="No">maven {
  url 'https://maven.google.com'
}
</code></pre>
	</li>
	<li>Si votre projet utilise la publicité avec Google IMA, mettez à jour les annonces des services Google Play :
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.google.android.gms:play-services-ads:'+PLAY_SERVICES_VERSION
</code></pre>

	<aside class="bcls-aside bcls-aside--information">Il est important de noter ici que le Brightcove Native Player SDK pour Android ne prend pas en charge les applications qui tentent d'utiliser à la fois ExoPlayer et ExoPlayer 2.</aside>
	</li>
	<li>Dans ton <strong>build.gradle</strong> fichier, où vous avez précédemment importé la bibliothèque Brightcove ExoPlayer en tant que dépendance comme ceci :
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer:${anpVersion}"
}
</code></pre>

	<p>Modifiez le nom de la dépendance :</p>

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}
</code></pre>

	<p>La valeur actuelle de la version Brightcove SDK (<code translate="No">anpVersion</code> ) se trouve dans le <a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/gradle.properties">gradle.properties</a> déposer.</p>
	</li>
	<li>Réglage de la <code translate="No">transitive</code> possibilité de <code translate="No">true</code> indique à gradle d'inclure automatiquement d'autres dépendances telles que le plug-in de lecture hors ligne. Si vous utilisez une version gradle inférieure à 5, le <a href="https://docs.gradle.org/current/userguide/dependency_management.html">dépendances transitives</a> sont désactivés par défaut. Vous devrez donc ajouter les éléments suivants :
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
	implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>Si vous utilisez une variable d'environnement pour la version SDK, ouvrez le <strong>gradle.properties</strong> et définissez la valeur de la version actuelle du SDK natif pour Android. Cela devrait ressembler à ceci :
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>

	<p>Aucun codage supplémentaire ne devrait être requis pour intégrer ExoPlayer 2 dans votre projet.</p>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_MediaPlayer_project">Projet MediaPlayer existant</h2>

<p>Suivez ces étapes pour mettre à jour un projet MediaPlayer existant afin d'utiliser le framework ExoPlayer 2 :</p>

<ol class="bcls-tasklist-restart">
	<li>Dans ton <strong>build.gradle</strong> fichier, ajoutez la dépendance suivante :

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li>Réglage de la <code translate="No">transitive</code> possibilité de <code translate="No">true</code> indique à gradle d'inclure automatiquement d'autres dépendances telles que le plug-in de lecture hors ligne. Si vous utilisez une version gradle inférieure à 5, le <a href="https://docs.gradle.org/current/userguide/managing_transitive_dependencies.html">dépendances transitives</a> sont désactivés par défaut. Vous devrez donc ajouter les éléments suivants :
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>Si vous utilisez une variable d'environnement pour la version SDK, ouvrez le <strong>gradle.properties</strong> et définissez la valeur de la version actuelle du SDK natif pour Android. Cela devrait ressembler à ceci :
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
	<li>Dans votre application, utilisez le <a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveExoPlayerVideoView.html">BrightcoveExoPlayerVidéoVoir</a> à la place du <a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveVideoView.html">BrightcoveVidéoVoir</a> , qui utilise Android Media Player.</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Breaking_changes">Changements marquants</h2>

<p>Les modifications suivantes apportées au Brightcove Native SDK pour Android sont des modifications majeures avec l'ExoPlayer 2. L'utilisation de l'ExoPlayer 1 a été dépréciée avec le Brightcove Native SDK.</p>

<h3>Écouteurs internes ExoPlayerVideoDisplayComponent</h3>

<p>Les <code translate="No">ExoPlayerVideoDisplayComponent</code> class vous permet de définir des écouteurs pour obtenir le statut des composants ExoPlayer. Voici une liste de certains des auditeurs :</p>

<table class="bcls-table">
	<thead class="bcls-table__head">
		<tr>
			<th>Définir l'auditeur</th>
			<th>Recevoir des informations sur l'état de</th>
		</tr>
	</thead>
	<tbody class="bcls-table__body">
		<tr>
			<td>setDebugListener</td>
			<td>InfoListener</td>
		</tr>
		<tr>
			<td>setCaptionListener</td>
			<td>Écouteur de légende</td>
		</tr>
		<tr>
			<td>setMetadataListener</td>
			<td>Écouteur de métadonnées</td>
		</tr>
		<tr>
			<td>setInternalErrorListener</td>
			<td>InterneErrorListener</td>
		</tr>
	</tbody>
</table>

<p>Vous trouverez ci-dessous des recommandations pour l'utilisation de l'ExoPlayer 2.</p>

<h4>InfoListener</h4>

<p>Pour le <code translate="No">InfoListener</code> interface, les modifications suivantes ont été apportées :</p>

<ul>
	<li>Les <code translate="No">onAvailableRangeChanged</code> la méthode a été supprimée</li>
	<li>Les <code translate="No">onLoadStarted</code> la méthode a un autre <code translate="No">length</code> paramètre</li>
</ul>

<p>Exemple: ExoPlayerVideoDisplayComponent utilisant ExoPlayer 2</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InfoListener {
void onVideoFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onAudioFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onDroppedFrames(int count, long elapsed);
void onBandwidthSample(int elapsedMs, long bytes, long bitrateEstimate);
void onLoadStarted(int sourceId, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs);
void onLoadCompleted(int sourceId, long bytesLoaded, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs, long elapsedRealtimeMs, long loadDurationMs);
void onDecoderInitialized(String decoderName, long initializedTimestampMs,
				long initializationDurationMs);
}</code></pre>

<h4>Écouteur de légende</h4>

<p>Les <code translate="No">CaptionListener</code> l'interface est inchangée.</p>

<p>Exemple: ExoPlayerVideoDisplayComponent utilisant ExoPlayer v2</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface CaptionListener {
void onCues(List&lt;Cue&gt; cues);
}</code></pre>

<h4>Écouteur de métadonnées</h4>

<p>Les <code translate="No">MetadataListener</code> l'interface a été introduite avec ExoPlayer v2. L'utilisation antérieure du <code translate="No">Id3MetadataListener</code> est désormais obsolète.</p>

<p>Exemple: ExoPlayerVideoDisplayComponent utilisant ExoPlayer v2</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface MetadataListener {
void onMetadata(Metadata metadata);
}</code></pre>

<p>Avec le nouveau <code translate="No">MetadataListener</code> vous recevrez un <code translate="No">Metadadata</code> objet dans le <code translate="No">onMetadata</code> rappeler. Avec l'obsolète <code translate="No">Id3MetadataListener</code> , vous avez reçu une liste d'objets Id3Frame. Avec le nouvel auditeur, vous pouvez toujours obtenir une liste de <code translate="No">Id3Frame</code> objets comme indiqué ci-dessous :</p>

<pre class="line-numbers">
<code class="language-java" translate="No">exoPlayerVideoDisplayComponent.setMetadataListener(new ExoPlayerVideoDisplayComponent.MetadataListener() {
@Override
public void onMetadata(Metadata metadata) {
 for(int i = 0; i &lt; metadata.length(); i++) {
		 Metadata.Entry entry = metadata.get(i);
		 if (entry instanceof Id3Frame) {
				 Id3Frame id3Frame = (Id3Frame) entry;
		 }
 }
}
});
</code></pre>

<h4>InterneErrorListener</h4>

<p>Les <code translate="No">InternalErrorListener</code> l'interface a de nombreux changements. Veuillez vérifier le code ci-dessous pour comparaison :</p>

<p>ExoPlayerVideoDisplayComponent utilisant ExoPlayer v2</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onPlayerError(Exception e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>ExoPlayerVideoDisplayComponent utilisant ExoPlayer v1 (<strong>obsolète</strong>)</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onRendererInitializationError(Exception e);
void onAudioTrackInitializationError(AudioTrack.InitializationException e);
void onAudioTrackWriteError(AudioTrack.WriteException e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onDecoderInitializationError(MediaCodecTrackRenderer.DecoderInitializationException e);
void onCryptoError(MediaCodec.CryptoException e);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>Lorsque vous utilisez ExoPlayer 2, le type d'exception que vous obtenez <code translate="No">onPlayerError(Exception e)</code> est <code translate="No">com.google.android.exoplayer2.ExoPlaybackException</code> , mais cela peut changer à l'avenir.</p>

<p>En utilisant com.google.android.exoplayer2.ExoPlaybackException, vous pouvez obtenir les types d'exceptions suivants :</p>

<ul>
	<li><code translate="No">ExoPlaybackException.TYPE_SOURCE</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_RENDERER</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_UNEXPECTED</code></li>
</ul>

<p>Vous pouvez également récupérer la cause de l'erreur en obtenant le <code translate="No">Throwable</code> objet avec <code translate="No">ExoPlaybackException.getSourceException()</code>.</p>

<h3>Prise en charge de la lecture hors ligne</h3>

<p>Si votre projet utilise le <code translate="No">MediaDownloadable.setConfigurationBundle(Bundle)</code> méthode pour spécifier les préférences de téléchargement telles que le débit vidéo, veuillez mettre à jour votre code comme suit :</p>

<p>Ancien format (obsolète)</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.google.android.exoplayer.MediaFormat
</code></pre>

<p>Nouveau format</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.brightcove.player.model.MediaFormat
</code></pre>

<h3>Classes d'API Media héritées</h3>

<p>Les classes d'API Media héritées obsolètes, dans le <code translate="No">com.brightcove.player.media package</code> , ont été supprimés du Brightcove Native SDK pour Android.</p>

<p>Si vous utilisiez les classes Media, vous devez migrer et commencer à utiliser le <code translate="No">com.brightcove.player.edge.Catalog</code> classer.</p>

<p>Les classes suivantes ont été déplacées de <code translate="No">com.brightcove.player.media</code> à <code translate="No">com.brightcove.player.model</code>:</p>

<ul>
	<li><code translate="No">DeliveryType.java</code></li>
	<li><code translate="No">CaptionType.java</code></li>
	<li><code translate="No">ErrorFields.java</code></li>
	<li><code translate="No">VideoFields.java</code></li>
</ul>

<aside class="bcls-aside bcls-aside--tip">Si vous utilisez l'une de ces quatre classes, il vous suffit de remplacer le package d'importation et vous serez prêt.</aside>
</section>

<section class="bcls-section">
<h2 id="Additional_Resources">Ressources additionnelles</h2>

<p>Pour plus d'informations sur l'utilisation du framework ExoPlayer 2, consultez les documents suivants :</p>

<ul>
	<li><a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2 - Nouveaux packages et noms de classes</a></li>
	<li><a href="https://google.github.io/ExoPlayer/guide.html">Guide du développeur ExoPlayer</a></li>
</ul>
</section>
</article>